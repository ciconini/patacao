<div class="store-settings">
  <div class="page-header">
    <div class="header-content">
      <h1>Configurações da Loja</h1>
      @if (store()) {
        <app-button
          [variant]="editMode() ? 'outline' : 'primary'"
          (click)="toggleEditMode()"
          [disabled]="saving()"
        >
          {{ editMode() ? 'Cancelar' : 'Editar' }}
        </app-button>
      }
    </div>
  </div>

  @if (loading()) {
    <div class="loading-state">
      <p>Carregando informações da loja...</p>
    </div>
  } @else if (!store()) {
    <div class="empty-state">
      <p>Loja não encontrada.</p>
    </div>
  } @else {
    <form [formGroup]="storeForm" (ngSubmit)="onSubmit()" class="settings-form">
      <div class="form-section">
        <h3 class="section-title">Informações Básicas</h3>
        
        <app-form-field
          formControlName="name"
          label="Nome da Loja"
          type="text"
          placeholder="Patacão Lisboa Centro"
          [required]="true"
          [error]="nameError"
          [disabled]="!editMode()"
        />

        @if (company()) {
          <div class="info-item">
            <span class="info-label">Empresa:</span>
            <span class="info-value">{{ company()!.name }}</span>
          </div>
        }
      </div>

      <div class="form-section">
        <h3 class="section-title">Endereço</h3>
        
        <div formGroupName="address" class="address-group">
          <app-form-field
            formControlName="street"
            label="Rua"
            type="text"
            placeholder="Avenida da Liberdade, 100"
            [disabled]="!editMode()"
          />

          <app-form-field
            formControlName="city"
            label="Cidade"
            type="text"
            placeholder="Lisboa"
            [disabled]="!editMode()"
          />

          <app-form-field
            formControlName="postalCode"
            label="Código Postal"
            type="text"
            placeholder="1250-096"
            [disabled]="!editMode()"
          />

          <app-form-field
            formControlName="country"
            label="País"
            type="text"
            placeholder="Portugal"
            [disabled]="!editMode()"
          />
        </div>
      </div>

      <div class="form-section">
        <h3 class="section-title">Contato</h3>
        
        <app-form-field
          formControlName="phone"
          label="Telefone"
          type="tel"
          placeholder="+351 21 123 4567"
          [disabled]="!editMode()"
        />

        <app-form-field
          formControlName="email"
          label="Email"
          type="email"
          placeholder="lisboa@patacao.pt"
          [disabled]="!editMode()"
        />
      </div>

      <div class="form-section">
        <h3 class="section-title">Horário de Funcionamento</h3>
        
        <div class="form-field">
          <label class="form-label" for="timezone">
            Fuso Horário <span class="required">*</span>
          </label>
          <select
            id="timezone"
            formControlName="timezone"
            class="form-select"
            [disabled]="!editMode()"
          >
            @for (tz of timezoneOptions; track tz.value) {
              <option [value]="tz.value">{{ tz.label }}</option>
            }
          </select>
        </div>

        <div formGroupName="openingHours" class="opening-hours">
          @for (day of daysOfWeek; track day.key) {
            <div [formGroupName]="day.key" class="day-schedule">
              <div class="day-header">
                <label class="day-label">
                  <input
                    type="checkbox"
                    formControlName="closed"
                    [disabled]="!editMode()"
                    class="closed-checkbox"
                  />
                  <span class="day-name">{{ day.label }}</span>
                </label>
              </div>
              
              @if (!storeForm.get('openingHours.' + day.key + '.closed')?.value) {
                <div class="day-times">
                  <app-form-field
                    formControlName="open"
                    label="Abertura"
                    type="time"
                    [disabled]="!editMode()"
                  />
                  
                  <app-form-field
                    formControlName="close"
                    label="Fechamento"
                    type="time"
                    [disabled]="!editMode()"
                  />
                </div>
              } @else {
                <div class="day-closed">
                  <span class="closed-text">Fechado</span>
                </div>
              }
            </div>
          }
        </div>
      </div>

      @if (store()) {
        <div class="info-section">
          <h3 class="section-title">Informações do Sistema</h3>
          <div class="info-grid">
            <div class="info-item">
              <span class="info-label">Criado em:</span>
              <span class="info-value">{{ formatDate(store()!.createdAt) }}</span>
            </div>
            @if (store()!.updatedAt) {
              <div class="info-item">
                <span class="info-label">Atualizado em:</span>
                <span class="info-value">{{ formatDate(store()!.updatedAt) }}</span>
              </div>
            }
          </div>
        </div>
      }

      @if (editMode()) {
        <div class="form-actions">
          <app-button
            type="button"
            variant="outline"
            (click)="toggleEditMode()"
            [disabled]="saving()"
          >
            Cancelar
          </app-button>
          
          <app-button
            type="submit"
            variant="primary"
            [loading]="saving()"
            [disabled]="storeForm.invalid || saving()"
          >
            Salvar Alterações
          </app-button>
        </div>
      }
    </form>
  }
</div>
